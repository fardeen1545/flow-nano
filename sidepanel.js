import{queryDOMElements as t,dom as e}from"./dom.js";import{state as o}from"./state.js";import{loadSettings as a}from"./settings.js";import{i18n as n}from"./i18n.js";import{setLanguage as r}from"./language.js";import{fetchConfigAndAuthorInfo as l}from"./config.js";import{attachEventListeners as i,attachChromeListeners as u}from"./handlers.js";import{updateButtonStates as s,updateInterfaceVisibility as d,updateUIAfterModeChange as c,updateLiveStatus as m,updateQueueModal as p}from"./ui.js";function B(){try{e.mainActionButton&&(e.mainActionButton.disabled=!0),e.promptsTextarea&&(e.promptsTextarea.disabled=!0),e.uploadPromptButton&&(e.uploadPromptButton.disabled=!0),e.modeSelector&&(e.modeSelector.disabled=!0),e.uploadImageButton&&(e.uploadImageButton.disabled=!0),e.startNewProjectButton&&(e.startNewProjectButton.disabled=!0),e.startCurrentProjectButton&&(e.startCurrentProjectButton.disabled=!0),e.navigateToFlowButton&&(e.navigateToFlowButton.disabled=!0),e.addToQueueButton&&(e.addToQueueButton.disabled=!0),e.clearQueueButton&&(e.clearQueueButton.disabled=!0),e.jobDownloadFolderInput&&(e.jobDownloadFolderInput.disabled=!0),e.confirmClearQueueButton&&(e.confirmClearQueueButton.disabled=!0),e.cancelClearQueueButton&&(e.cancelClearQueueButton.disabled=!0),e.queueResetAllButton&&(e.queueResetAllButton.disabled=!0),e.queueDeleteAllButton&&(e.queueDeleteAllButton.disabled=!0)}catch(t){console.error("Error disabling UI:",t)}}document.addEventListener("DOMContentLoaded",async()=>{try{if(t(),!(e.mainActionButton&&e.stopButton&&e.startNewProjectButton&&e.startCurrentProjectButton&&e.logDisplay&&e.liveStatus&&e.uploadPromptButton&&e.wrongPageMessageElement&&e.autoDownloadCheckbox&&e.openDownloadsSettingsLink&&e.modeSelector&&e.imageModeContainer&&e.aspectRatioSelector&&e.modelSelector&&e.imageSortSelector&&e.navigateToFlowButton&&e.addToQueueButton&&e.openQueueButton&&e.clearQueueButton&&e.queueModalOverlay&&e.promptsTextarea&&e.startFromInput&&e.repeatCountInput&&e.minInitialWaitTimeInput&&e.maxInitialWaitTimeInput&&e.languageSelector&&e.jobDownloadFolderInput&&e.imageInput&&e.fileInput&&e.copyFailedButton&&e.closeQueueModal&&e.queueListDisplay&&e.confirmClearQueueModal&&e.confirmClearQueueButton&&e.cancelClearQueueButton&&e.confirmClearQueueMessage&&e.queueResetAllButton&&e.queueDeleteAllButton)){console.error("Interface initialization failed! Critical DOM elements are missing.");const t=n("log_init_fail_critical");B();try{m(t,"CRITICAL")}catch(t){console.error("Failed to update status, liveStatus element might be missing.")}return}e.mainActionButton.style.display="flex",e.startNewProjectButton.style.display="none",e.startCurrentProjectButton.style.display="none",m(n("status_loading_config"),"info");if(!await l())return B(),void m(n("log_config_load_error")||"Failed to load critical config. Please try reloading.","error");a(()=>{r(o.currentLang);const t=`${n("job_folder_prefix")||"Project-"}${o.nextProjectCounter.toString().padStart(2,"0")}`;e.jobDownloadFolderInput.value=t,c(),p(),i(),s(),d(),u()})}catch(t){console.error("Initialization failed:",t),B();const o=n("log_init_fail_critical")||"Interface initialization failed! Please reload.";try{e.liveStatus&&m(o,"CRITICAL")}catch(t){console.error("Failed to update status during catch, liveStatus element might be missing.")}}});