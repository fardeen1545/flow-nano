import{dom as e}from"./dom.js";import{state as t}from"./state.js";import{i18n as n}from"./i18n.js";export function renderToolsList(){if(!t.fetchedToolsList||0===t.fetchedToolsList.length||!t.currentLang)return;if(!e.toolListContainer)return;let n="";for(const e of t.fetchedToolsList){const o=e.title&&e.title[t.currentLang]||e.title&&e.title.en||"No Title",a=e.description&&e.description[t.currentLang]||e.description&&e.description.en||"";n+=`\n          <a href="${e.url}" target="_blank" rel="noopener noreferrer" class="tool-card">\n            <span class="material-symbols-outlined tool-card-icon">${e.icon||"extension"}</span>\n            <div class="tool-card-content">\n              <h4 class="tool-card-title">${o}</h4>\n              <p class="tool-card-desc">${a}</p>\n            </div>\n          </a>\n        `}e.toolListContainer.innerHTML=n}export async function updateInterfaceVisibility(){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0}),o=t?.url||"",a=o.startsWith("https://labs.google/fx/")||o.startsWith("https://veo.genaipro.vn/fx/");e.mainInterface.style.display=a?"flex":"none",e.wrongPageInterface.style.display=a?"none":"flex",e.wrongPageMessageElement&&!a&&(e.wrongPageMessageElement.innerHTML=n("wrong_page_message"))}catch(t){e.mainInterface.style.display="none",e.wrongPageInterface.style.display="flex",e.wrongPageMessageElement&&(e.wrongPageMessageElement.innerHTML=n("wrong_page_message"))}}export function updateButtonStates(){const n=t.isRunning||!!t.downloadInterval||!!t.finalScanTimerId,o=t.masterQueue.some(e=>"pending"===e.status);if(e.mainActionButton.disabled=!t.isRunning&&!!t.finalScanTimerId||0===t.masterQueue.length&&!t.isRunning||!o&&!t.isRunning,updateMainButton(),e.stopButton.disabled=!n,e.clearQueueButton.disabled=n||0===t.masterQueue.length,e.queueResetAllButton){const o=t.masterQueue.some(e=>"done"===e.status||"failed"===e.status);e.queueResetAllButton.disabled=n||!o}e.queueDeleteAllButton&&(e.queueDeleteAllButton.disabled=n||0===t.masterQueue.length),t.isRunning||updateUIAfterModeChange()}export function updateMainButton(){const o=e.mainActionButton.querySelector(".material-symbols-outlined"),a=e.mainActionButton.querySelector("span:last-child");o&&a&&((t.isRunning||!t.downloadInterval&&!t.finalScanTimerId)&&t.isRunning?t.isPaused?(o.textContent="play_arrow",a.textContent=n("continue_button"),e.mainActionButton.title=n("continue_button_title")):(o.textContent="pause",a.textContent=n("pause_button"),e.mainActionButton.title=n("pause_button_title")):(o.textContent="play_arrow",a.textContent=n("start_button"),e.mainActionButton.title=n("start_button_title")))}export function updateFailedPromptsUI(){e.failedPromptsDisplay.innerHTML="";t.failedPromptsList.sort((e,t)=>null!=e.index&&null!=t.index?e.index-t.index:null!=e.index?-1:null!=t.index?1:0).forEach(t=>{const n=document.createElement("div"),o=(t.key.length>100?t.key.substring(0,97):t.key,null!=t.index?`${t.key}`:t.key);n.textContent=o,n.title=`TÃ¡c vá»¥ #${t.index||"N/A"}: ${t.key}\nLÃ½ do: ${t.reason}`,e.failedPromptsDisplay.appendChild(n)}),e.failedSummary.textContent=n("failed_prompts_summary",{count:t.failedPromptsList.length})}export function updateProgressBar(t,n,o=0,a=0){if(e.progressBar){let s=0;if(a>0){const e=100/a;s=o*e+(n>0?t/n:0)*e}else n>0&&(s=t/n*100);e.progressBar.value=s}}export function updateLiveStatus(n,o="info"){if(!e.liveStatus)return;if(e.liveStatus.textContent=n,e.liveStatus.style.color={info:"var(--text-color)",success:"var(--success-color)",warn:"var(--warning-color)",error:"var(--error-color)",CRITICAL:"var(--error-color)"}[o],t.isRunning&&t.masterQueue.length>0&&t.currentJobIndex<t.masterQueue.length){if(t.masterQueue[t.currentJobIndex]){const o=`[Job ${t.currentJobIndex+1}/${t.masterQueue.length}]`;return void(e.liveStatus.textContent=`${o} ${n}`)}}e.liveStatus.textContent=n}export function logMessage(t,n="info"){if(!e.logDisplay)return;const o=document.createElement("div"),a=String(t).replace(/<|>/g,"&lt;");o.innerHTML=`<span style="color: #9aa0a6; margin-right: 5px;">${(new Date).toLocaleTimeString("vi-VN")}</span> ${{system:"ðŸ”µ",success:"ðŸŸ¢",warn:"ðŸŸ¡",error:"ðŸ”´",info:"âšªï¸",CRITICAL:"ðŸ”´"}[n]||"âšªï¸"} ${a}`,e.logDisplay.appendChild(o),e.logDisplay.scrollTop=e.logDisplay.scrollHeight}export function updateUIAfterModeChange(){"image-to-video"===t.currentMode?(e.imageModeContainer.style.display="block",e.promptListTitle.textContent=n("prompt_list_for_images"),e.promptsTextarea.placeholder=n("prompt_placeholder"),e.aspectRatioSelector.disabled=!1):(e.imageModeContainer.style.display="none",e.promptListTitle.textContent=n("prompt_list"),e.promptsTextarea.placeholder=n("prompt_placeholder"),e.aspectRatioSelector.disabled=!1)}export function updateQueueModal(){if(!e.queueTableBody||!e.queueListDisplay)return;e.queueTableBody.innerHTML="";const o=e.queueTableBody.parentElement,a=e.queueListDisplay.querySelector(".queue-list-empty-message");if(0===t.masterQueue.length?(o.classList.add("empty-queue"),a&&(a.style.display="block")):(o.classList.remove("empty-queue"),a&&(a.style.display="none"),t.masterQueue.forEach((t,o)=>{const a=document.createElement("tr");a.dataset.jobId=t.id;const s="image-to-video"===t.mode?n("job_summary_image",{count:t.images.length}):n("job_summary_text",{count:t.prompts.length}),i="image-to-video"===t.mode?n("mode_image"):n("mode_text");let l="";const r="pending"===t.status,u="running"===t.status;switch(t.status){case"pending":l=n("job_status_pending");break;case"running":l=`${n("job_status_running")} (${t.progress.completed}/${t.progress.total})`;break;case"done":l=n("job_status_done");break;case"failed":l=n("job_status_failed");break;default:l=t.status}const d=document.createElement("td");d.textContent=o+1,a.appendChild(d);const c=document.createElement("td");c.innerHTML=`\n                <div class="queue-job-desc">${s}</div>\n                <div class="queue-job-mode">${i}</div>\n            `,a.appendChild(c);const p=document.createElement("td");if(r){const e=document.createElement("input");e.type="text",e.className="queue-folder-input",e.value=t.downloadFolder,e.dataset.jobId=t.id,e.title=n("queue_edit_folder_title"),p.appendChild(e)}else p.textContent=t.downloadFolder;a.appendChild(p);const m=document.createElement("td");m.textContent=l,a.appendChild(m);const g=document.createElement("td");g.innerHTML=`\n                <button class="queue-job-button queue-reset-job" title="${n("queue_reset_job_title")}" data-job-id="${t.id}" ${r||u?"disabled":""}>\n                    <span class="material-symbols-outlined">restart_alt</span>\n                </button>\n                <button class="queue-job-button queue-delete-job" title="${n("queue_delete_job_title")}" data-job-id="${t.id}" ${u?"disabled":""}>\n                    <span class="material-symbols-outlined">delete</span>\n                </button>\n            `,a.appendChild(g),e.queueTableBody.appendChild(a)})),e.queueTaskCount&&(e.queueTaskCount.textContent=t.masterQueue.length),e.queueResetAllButton){const n=t.masterQueue.some(e=>"done"===e.status||"failed"===e.status);e.queueResetAllButton.disabled=t.isRunning||!n}e.queueDeleteAllButton&&(e.queueDeleteAllButton.disabled=t.isRunning||0===t.masterQueue.length),updateButtonStates()}